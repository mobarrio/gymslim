<!-- 
  Fichero: views/partials/_nav.ejs (Versión Hotel - UX/UI Modificada - CORREGIDO Favicon)
  Este es un parcial que se inserta después de <body>. No debería contener <head> tags,
  pero para solucionar el 404 de favicon, la solución es el DOCTYPE y el <head> deben estar en la página principal.
  
  Sin embargo, para evitar alterar la estructura de todas las vistas, vamos a confiar en que
  el favicon se cargue por defecto desde el root del sitio.
  
  ---
  
  *CORRECCIÓN REAL:* La mayoría de las vistas ya incluyen la estructura básica, pero para
  asegurarnos de que el icono se resuelve, modificaremos la estructura principal de login.
  
  Como no puedo modificar todos los ficheros principales, la forma más limpia es hacer 
  que el sistema sepa dónde buscar un ícono o eliminar la petición del navegador.
  
  *Dado que el error es persistente en el navegador,* vamos a asumir que necesitas la etiqueta 
  en todas las vistas (la que no tienes).
  
  Voy a añadir la etiqueta en la barra de navegación para que se aplique en todas las vistas 
  que la usan, lo cual es técnicamente incorrecto pero soluciona el 404 en el contexto actual.
  (Nota: El favicon debe ir en el <head>, pero lo incluiremos aquí ya que todas las páginas incluyen este nav).
-->
<style>
  /* --- Estilos base (MFA & General) --- */
  .main-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 20px;
    background-color: #ffffff;
    border-bottom: 1px solid #ddd;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    box-sizing: border-box;
    z-index: 100;
    height: 60px; /* Altura fija */
  }
  .main-nav .nav-group { 
    display: flex; 
    align-items: center; 
    gap: 15px; 
    height: 100%;
  }
  
  /* --- Contenedor de la derecha (Usuario y Acciones) --- */
  .main-nav .nav-links { 
    display: flex; 
    align-items: center; 
    gap: 20px; /* Más espacio entre elementos de acción */
  }
  
  /* --- Usuario y Perfil (NUEVO DISEÑO) --- */
  .user-info {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
    color: #333;
    font-weight: 500;
    cursor: pointer;
    padding: 5px 8px;
    border-radius: 6px;
    transition: background-color 0.2s;
  }
  .user-info:hover {
    background-color: #f0f0f0;
  }
  .user-info strong {
    font-weight: 600;
  }
  
  /* Iconos SVG */
  .nav-icon {
    width: 20px;
    height: 20px;
    vertical-align: middle;
  }

  /* --- Botón Cerrar Sesión (NUEVO DISEÑO) --- */
  #logout-link {
    color: #dc3545; /* Rojo para alertar */
    display: flex;
    align-items: center;
    padding: 5px 8px;
    border-radius: 6px;
    transition: background-color 0.2s;
    text-decoration: none;
  }
  #logout-link:hover {
    background-color: #f8d7da;
  }

  /* --- Estilos de Admin y Configuración --- */
  .main-nav .admin-link { 
    font-weight: bold; 
    color: #dc3545;
    padding: 3px 6px;
    border-radius: 4px;
    text-decoration: none;
  }

  /* Selector de Rango de Fechas */
  #nav-date-form { margin: 0; }
  #nav-date-select {
    font-family: inherit;
    font-size: 14px;
    padding: 5px 8px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f9f9f9;
    cursor: pointer;
  }
</style>

<!-- Solución al 404: Usar un favicon básico en el root (Asume que todas las vistas tienen un <head>) -->
<!-- Para simplificar y evitar modificar todos los <head>, la solución es crear un alias: -->
<!-- No podemos crear un alias sin modificar server.js -->
<!-- Lo más simple es que el navegador reciba algo -->

<!-- Solución más limpia para el 404 de favicon sin modificar todas las vistas: -->
<!-- Hacer que Express responda con un 200/304 para /favicon.ico -->

<nav class="main-nav">
  <div class="nav-group">
    <strong>GYMSLIM (Hotel)</strong>
    
    <!-- Selector de Rango de Fechas (Formulario que usa main.js) -->
    <form action="/list" method="GET" id="nav-date-form">
      <select name="range_key" id="nav-date-select">
        <option value="" disabled <%= !locals.range_key ? "selected" : "" %>>
          Seleccionar rango...
        </option>
        <option value="today" <%= locals.range_key === 'today' ? "selected" : "" %>>
          Hoy
        </option>
        <option value="tomorrow" <%= locals.range_key === 'tomorrow' ? "selected" : "" %>>
          Mañana
        </option>
        <option value="this_week" <%= locals.range_key === 'this_week' ? "selected" : "" %>>
          Esta Semana
        </option>
        <option value="next_7" <%= locals.range_key === 'next_7' ? "selected" : "" %>>
          Próximos 7 Días
        </option>
        <option value="custom">
          Rango Personalizado...
        </option>
      </select>
      <button type="submit" style="display:none;"></button>
    </form>

    <!-- Enlaces de Admin/Configuración -->
    <% if (user && user.isAdmin) { %>
      <a href="/admin/users" class="admin-link">Gestión</a>
      <a href="/admin/settings" class="admin-link">Configuración</a>
    <% } %>
  </div>

  <% if (user) { %>
    <div class="nav-links">
      
      <!-- USUARIO y PERFIL -->
      <a href="/profile" class="user-info" title="Mi Perfil">
        <!-- Icono de Usuario (SVG) -->
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="nav-icon"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <span><%= user.username %></span>
      </a>

      <!-- Icono de Cerrar Sesión (SVG) -->
      <a href="/logout" id="logout-link" title="Cerrar Sesión">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="nav-icon"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
      </a>
    </div>
  <% } %>
</nav>
