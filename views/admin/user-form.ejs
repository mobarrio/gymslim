<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuario</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        body { padding-top: 70px; }
        .container-admin { max-width: 600px; margin: 20px auto; }
        .label-inline {
            display: inline-block;
            font-weight: normal;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <%- include('../partials/_nav') %>

    <div class="container-admin">

        <% if (user && user.id) { %>
            <h1>Editar Usuario: <%= user.username %></h1>
        <% } else { %>
            <h1>Crear Nuevo Usuario</h1>
        <% } %>

        <form action="<%= (user && user.id) ? '/admin/users/edit/' + user.id : '/admin/users/new' %>" method="POST" class="form-container">

            <% if (locals.error) { %>
                <div class="error-msg"><%= error %></div>
            <% } %>

            <div>
                <label for="username">Usuario (Login):</label>
                <input type="text" id="username" name="username" value="<%= user ? user.username : '' %>" required>
            </div>

            <!-- --- CAMPO MODIFICADO (AÑADIDO) --- -->
            <div>
                <label for="name">Nombre (para reservas):</label>
                <input type="text" id="name" name="name" value="<%= (user && user.name) ? user.name : '' %>">
            </div>

            <!-- --- CAMPO MODIFICADO (AÑADIDO) --- -->
            <div>
                <label for="bookingEmail">Email de Reserva:</label>
                <input type="email" id="bookingEmail" name="bookingEmail" value="<%= (user && user.bookingEmail) ? user.bookingEmail : '' %>">
                <small>El email que usará este usuario para las reservas.</small>
            </div>

            <!-- --- LÓGICA MODIFICADA (Contraseña) --- -->
            <% if (!user || !user.id) { %>
                <!-- Solo mostrar al CREAR -->
                <div>
                    <label for="password">Contraseña:</label>
                    <input type="password" id="password" name="password" required>
                    <small>El usuario deberá cambiarla en su primer login.</small>
                </div>
            <% } else { %>
                <!-- Mostrar al EDITAR -->
                <div class="info-msg">
                    <p>Para resetear la contraseña, usa el botón <strong>"Resetear Pass"</strong> en la lista de usuarios.</p>
                </div>
            <% } %>
            <!-- --- FIN LÓGICA MODIFICADA --- -->

            <div>
                <input type="checkbox" id="isAdmin" name="isAdmin" <%= (user && user.isAdmin) ? 'checked' : '' %>>
                <label for="isAdmin" class="label-inline">Es Administrador</label>
            </div>

            <button type="submit" class="btn-primary">
                <%= (user && user.id) ? 'Actualizar Usuario' : 'Crear Usuario' %>
            </button>
            <a href="/admin/users" class="btn-secondary-link">Cancelar</a>

        </form>

    </div>
    
    <!-- --- ¡¡¡CORRECCIÓN AÑADIDA!!! --- -->
    <script src="/js/main.js"></script>

</body>
</html>
